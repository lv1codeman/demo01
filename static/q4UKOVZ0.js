import{_ as B,r,e as H,l as I,k as $,c as x,a as f,m as j,b as e,t as y,w as u,o as b,d as i}from"#entry";import{V as k,a as w,b as F,c as Y}from"./BOkWwRnY.js";import{V as z,a as q,b as J,c as K}from"./Cc83QHOa.js";import{V as L,a as s,b as Q,c as n,d as W}from"./CgAdwC9A.js";import{V as M,a as Z}from"./C8HJIBX_.js";import"./sFGZLvaJ.js";const h={key:0,class:"text-red-500"},ll={class:"d-flex ga-4 justify-space-between align-center"},el={class:"d-flex ga-4 align-center"},al={__name:"DBmaintain",setup(tl){const c=r([]),V=r(""),m=r(null),T=r(!1),t=r({}),C=r(""),p=r(null),N=r([]),v=r(null),O=[{value:"ID",title:"ID",sortable:!1,width:"0px",class:"d-none",cellClass:"d-none"},{value:"COLLEGE",title:"學院全名"},{value:"COLLEGESHORT",title:"學院簡稱"},{value:"DEPTSHORT",title:"系所簡稱"},{value:"DEPT",title:"系所全名"},{value:"STYPE",title:"學制"},{value:"AGENT",title:"承辦人"},{value:"AGENTEXT",title:"承辦人分機"},{value:"AGENTEMAIL",title:"承辦人Email"},{value:"CAGENT",title:"課務承辦人"},{value:"CAGENTEXT",title:"課務承辦人分機"},{value:"CAGENTEMAIL",title:"課務承辦人Email"},{value:"actions",title:"操作",sortable:!1}],{$curridataAPI:E}=H(),P=I(()=>C.value==="add"?"新增系所":"編輯系所"),S=I(()=>{if(!V.value)return c.value;const o=V.value.toLowerCase();return c.value.filter(l=>Object.values(l).some(a=>String(a).toLowerCase().includes(o)))}),d=o=>!!o||"此欄位為必填。",U=async()=>{try{const o=await E.get("/get_cagent");N.value=o.data}catch(o){console.error("無法從 API 取得課務承辦人資料。",o)}},_=o=>{o?(t.value.CAGENT=o.NAME,t.value.CAGENTEXT=o.EXT,t.value.CAGENTEMAIL=o.EMAIL):(t.value.CAGENT=null,t.value.CAGENTEXT=null,t.value.CAGENTEMAIL=null)},G=async()=>{try{const o=await E.get("/get_deptlist");c.value=o.data}catch(o){console.error(o),m.value="無法從 API 取得資料。"}},g=(o,l={})=>{if(C.value=o,t.value={...l},o==="edit"&&t.value.CAGENT){const a=t.value.CAGENT.trim();v.value=N.value.find(A=>A.NAME&&A.NAME.trim()===a)}else v.value=null;T.value=!0},D=()=>{T.value=!1,t.value={},v.value=null,p.value&&p.value.resetValidation()},X=async()=>{const{valid:o}=await p.value.validate();if(o)try{C.value==="add"?await E.post("/add_dept",t.value):await E.put("/update_dept",t.value),D(),await G()}catch(l){console.error(l),m.value=l.response?.data?.detail||"儲存資料失敗。"}},R=async o=>{if(confirm(`確定要刪除系所 ${o.DEPT} 嗎？`))try{await E.delete(`/delete_dept/${o.ID}`),await G()}catch(l){console.error(l),m.value=l.response?.data?.detail||"刪除資料失敗。"}};return $(()=>{G(),U()}),(o,l)=>(b(),x("div",null,[l[20]||(l[20]=f("h2",null,"系所表維護",-1)),m.value?(b(),x("div",h,[f("p",null,y(m.value),1)])):(b(),j(k,{key:1,class:"mt-4"},{default:u(()=>[e(w,null,{default:u(()=>[f("div",ll,[l[15]||(l[15]=f("span",null,"系所表",-1)),f("div",el,[e(L,{color:"primary","prepend-icon":"mdi-plus-circle",onClick:l[0]||(l[0]=a=>g("add")),height:"40"},{default:u(()=>[...l[14]||(l[14]=[i("新增系所",-1)])]),_:1}),e(s,{modelValue:V.value,"onUpdate:modelValue":l[1]||(l[1]=a=>V.value=a),label:"輸入關鍵字查詢","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"","single-line":"",class:"search-field"},null,8,["modelValue"])])])]),_:1}),e(q,{headers:O,items:S.value,class:"elevation-10"},{"item.actions":u(({item:a})=>[e(M,{class:"me-2",size:"small",onClick:A=>g("edit",a)},{default:u(()=>[...l[16]||(l[16]=[i(" mdi-pencil ",-1)])]),_:1},8,["onClick"]),e(M,{size:"small",onClick:A=>R(a)},{default:u(()=>[...l[17]||(l[17]=[i(" mdi-delete ",-1)])]),_:1},8,["onClick"])]),_:1},8,["items"])]),_:1})),e(z,{modelValue:T.value,"onUpdate:modelValue":l[13]||(l[13]=a=>T.value=a),"max-width":"600px"},{default:u(()=>[e(k,null,{default:u(()=>[e(w,null,{default:u(()=>[i(y(P.value),1)]),_:1}),e(F,null,{default:u(()=>[e(Z,null,{default:u(()=>[e(J,{ref_key:"form",ref:p},{default:u(()=>[e(Q,null,{default:u(()=>[e(n,{cols:"12",sm:"6"},{default:u(()=>[e(s,{modelValue:t.value.COLLEGE,"onUpdate:modelValue":l[2]||(l[2]=a=>t.value.COLLEGE=a),label:"學院全名",rules:[d]},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12",sm:"6"},{default:u(()=>[e(s,{modelValue:t.value.COLLEGESHORT,"onUpdate:modelValue":l[3]||(l[3]=a=>t.value.COLLEGESHORT=a),label:"學院簡稱",rules:[d]},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12",sm:"6"},{default:u(()=>[e(s,{modelValue:t.value.DEPTSHORT,"onUpdate:modelValue":l[4]||(l[4]=a=>t.value.DEPTSHORT=a),label:"系所簡稱",rules:[d]},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12",sm:"6"},{default:u(()=>[e(s,{modelValue:t.value.DEPT,"onUpdate:modelValue":l[5]||(l[5]=a=>t.value.DEPT=a),label:"系所全名",rules:[d]},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12",sm:"6"},{default:u(()=>[e(s,{modelValue:t.value.STYPE,"onUpdate:modelValue":l[6]||(l[6]=a=>t.value.STYPE=a),label:"學制",rules:[d]},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12",sm:"6"},{default:u(()=>[e(s,{modelValue:t.value.AGENT,"onUpdate:modelValue":l[7]||(l[7]=a=>t.value.AGENT=a),label:"承辦人",rules:[d]},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12",sm:"6"},{default:u(()=>[e(s,{modelValue:t.value.AGENTEXT,"onUpdate:modelValue":l[8]||(l[8]=a=>t.value.AGENTEXT=a),label:"承辦人分機",rules:[d]},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12",sm:"6"},{default:u(()=>[e(s,{modelValue:t.value.AGENTEMAIL,"onUpdate:modelValue":l[9]||(l[9]=a=>t.value.AGENTEMAIL=a),label:"承辦人Email",rules:[d]},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12",sm:"6"},{default:u(()=>[e(W,{modelValue:v.value,"onUpdate:modelValue":[l[10]||(l[10]=a=>v.value=a),_],items:N.value,"item-title":"NAME",label:"課務承辦人",rules:[d],"return-object":""},null,8,["modelValue","items","rules"])]),_:1}),e(n,{cols:"12",sm:"6"},{default:u(()=>[e(s,{modelValue:t.value.CAGENTEXT,"onUpdate:modelValue":l[11]||(l[11]=a=>t.value.CAGENTEXT=a),label:"課務承辦人分機",readonly:""},null,8,["modelValue"])]),_:1}),e(n,{cols:"12",sm:"6"},{default:u(()=>[e(s,{modelValue:t.value.CAGENTEMAIL,"onUpdate:modelValue":l[12]||(l[12]=a=>t.value.CAGENTEMAIL=a),label:"課務承辦人Email",readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1}),e(Y,null,{default:u(()=>[e(K),e(L,{color:"blue-darken-1",variant:"text",onClick:D},{default:u(()=>[...l[18]||(l[18]=[i("取消",-1)])]),_:1}),e(L,{color:"blue-darken-1",variant:"text",onClick:X},{default:u(()=>[...l[19]||(l[19]=[i("儲存",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},il=B(al,[["__scopeId","data-v-66825420"]]);export{il as default};
