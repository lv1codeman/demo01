import{_ as j,r as n,e as S,j as w,k as X,c as y,a as d,l as z,b as l,t as D,w as a,o as I,d as r}from"#entry";import{V as A,a as E,b as F,c as P}from"./DR0YFD6k.js";import{V as R,a as q,b as O,c as G}from"./B1sYQCR7.js";import{V as k,a as f,b as H,c as x}from"./BSeejpMD.js";import{V as T}from"./DAlgEUWK.js";import{V as J}from"./DtRpVYze.js";const K={key:0,class:"text-red-500"},Q={class:"d-flex ga-4 justify-space-between align-center"},W={class:"d-flex ga-4 align-center"},Y={__name:"CurriAgent",setup(Z){const p=n([]),i=n(""),u=n(null),v=n(!1),s=n({}),V=n(""),m=n(null),M=[{value:"ID",key:"ID",title:"ID",sortable:!1,width:"0px",class:"d-none",cellClass:"d-none"},{value:"NAME",title:"姓名"},{value:"EXT",title:"分機"},{value:"EMAIL",title:"Email"},{value:"actions",title:"操作",sortable:!1}],{$curridataAPI:c}=S(),N=w(()=>V.value==="add"?"新增承辦人":"編輯承辦人"),$=w(()=>{if(!i.value)return p.value;const t=i.value.toLowerCase();return p.value.filter(e=>Object.values(e).some(o=>String(o).toLowerCase().includes(t)))}),g=t=>!!t||"此欄位為必填。",C=async()=>{try{const t=await c.get("/get_cagent");p.value=t.data}catch(t){console.error(t),u.value="無法從 API 取得資料。"}},_=(t,e={})=>{V.value=t,s.value={...e},v.value=!0},b=()=>{v.value=!1,s.value={},m.value&&m.value.resetValidation()},B=async()=>{const{valid:t}=await m.value.validate();if(t)try{V.value==="add"?await c.post("/add_cagent",s.value):(console.log(s.value),await c.put(`/update_cagent/${s.value.ID}`,s.value)),b(),await C()}catch(e){console.error(e),u.value=e.response?.data?.detail||"儲存資料失敗。"}},L=async t=>{if(!t||!t.ID){u.value="刪除失敗：無效的承辦人 ID。",console.error("嘗試刪除一個沒有 ID 的項目。");return}if(confirm(`確定要刪除承辦人 ${t.NAME} 嗎？`))try{await c.delete(`/delete_cagent/${t.ID}`),await C()}catch(e){console.error(e),u.value=e.response?.data?.detail||"刪除資料失敗。"}};return X(()=>{C()}),(t,e)=>(I(),y("div",null,[e[12]||(e[12]=d("h2",null,"課務承辦人維護",-1)),u.value?(I(),y("div",K,[d("p",null,D(u.value),1)])):(I(),z(A,{key:1,class:"mt-4"},{default:a(()=>[l(E,null,{default:a(()=>[d("div",Q,[e[7]||(e[7]=d("span",null,"課務承辦人",-1)),d("div",W,[l(k,{color:"primary","prepend-icon":"mdi-plus-circle",onClick:e[0]||(e[0]=o=>_("add")),height:"40"},{default:a(()=>[...e[6]||(e[6]=[r("新增承辦人",-1)])]),_:1}),l(f,{modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=o=>i.value=o),label:"輸入關鍵字查詢","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"","single-line":"",class:"search-field"},null,8,["modelValue"])])])]),_:1}),l(q,{headers:M,items:$.value,class:"elevation-10"},{"item.actions":a(({item:o})=>[l(T,{class:"me-2",size:"small",onClick:U=>_("edit",o)},{default:a(()=>[...e[8]||(e[8]=[r(" mdi-pencil ",-1)])]),_:1},8,["onClick"]),l(T,{size:"small",onClick:U=>L(o)},{default:a(()=>[...e[9]||(e[9]=[r(" mdi-delete ",-1)])]),_:1},8,["onClick"])]),_:1},8,["items"])]),_:1})),l(R,{modelValue:v.value,"onUpdate:modelValue":e[5]||(e[5]=o=>v.value=o),"max-width":"600px"},{default:a(()=>[l(A,null,{default:a(()=>[l(E,null,{default:a(()=>[r(D(N.value),1)]),_:1}),l(F,null,{default:a(()=>[l(J,null,{default:a(()=>[l(O,{ref_key:"form",ref:m},{default:a(()=>[l(H,null,{default:a(()=>[l(x,{cols:"12",sm:"6"},{default:a(()=>[l(f,{modelValue:s.value.NAME,"onUpdate:modelValue":e[2]||(e[2]=o=>s.value.NAME=o),label:"姓名",rules:[g]},null,8,["modelValue","rules"])]),_:1}),l(x,{cols:"12",sm:"6"},{default:a(()=>[l(f,{modelValue:s.value.EXT,"onUpdate:modelValue":e[3]||(e[3]=o=>s.value.EXT=o),label:"分機",rules:[g]},null,8,["modelValue","rules"])]),_:1}),l(x,{cols:"12",sm:"6"},{default:a(()=>[l(f,{modelValue:s.value.EMAIL,"onUpdate:modelValue":e[4]||(e[4]=o=>s.value.EMAIL=o),label:"Email",rules:[g]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1}),l(P,null,{default:a(()=>[l(G),l(k,{color:"blue-darken-1",variant:"text",onClick:b},{default:a(()=>[...e[10]||(e[10]=[r("取消",-1)])]),_:1}),l(k,{color:"blue-darken-1",variant:"text",onClick:B},{default:a(()=>[...e[11]||(e[11]=[r("儲存",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},se=j(Y,[["__scopeId","data-v-529d0b2c"]]);export{se as default};
